<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Gourav Shah">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Setting up Load Balancer with Ansible Galaxy - Ansible Tutorial</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Setting up Load Balancer with Ansible Galaxy";
    var mkdocs_page_input_path = "galaxy.md";
    var mkdocs_page_url = "/galaxy/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', '', 'ansible-tutorial.schoolofdevops.com');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Ansible Tutorial</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Bootcamp</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../setup/">Setting up the Environment</a>
                </li>
                <li class="">
                    
    <a class="" href="../ad-hoc/">Ad Hoc Server Maangement with Ansible</a>
                </li>
                <li class="">
                    
    <a class="" href="../playbooks/">Writing Playbook for Base System Configurations</a>
                </li>
                <li class="">
                    
    <a class="" href="../roles/">Configuring app server environment with Roles</a>
                </li>
                <li class="">
                    
    <a class="" href="../templates_and_variables/">Making roles reusable with vars and templates</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Setting up Load Balancer with Ansible Galaxy</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#setting-up-loadbalancer-with-a-galaxy-role">Setting up loadbalancer with a galaxy role</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#exercises">Exercises</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../control_structures/">Controlling execution flow with conditionals, iterators and tags</a>
                </li>
                <li class="">
                    
    <a class="" href="../magicvars_envs/">Auto discovery and multi environments</a>
                </li>
                <li class="">
                    
    <a class="" href="../ansible-vault/">Encrypting sensitive data with Ansible Vault</a>
                </li>
                <li class="">
                    
    <a class="" href="../update/">Setting up Zero Downtime Deployment</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Additional Topics</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../dynamic_inventory/">Dynamic Inventory</a>
                </li>
                <li class="">
                    
    <a class="" href="../ansible-windows/">Ansible on Windows</a>
                </li>
                <li class="">
                    
    <a class="" href="../ansible-pull/">Ansible Pull</a>
                </li>
                <li class="">
                    
    <a class="" href="../ansible-pull/">Ansible Tower</a>
                </li>
                <li class="">
                    
    <a class="" href="../registered_variables/">Registered Variable</a>
                </li>
                <li class="">
                    
    <a class="" href="../custom_modules/">Custom Module</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Troubleshooting</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../troubleshooting/">Troubleshooting Techniques</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Ansible Tutorial</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Bootcamp &raquo;</li>
        
      
    
    <li>Setting up Load Balancer with Ansible Galaxy</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/schoolofdevops/zero-to-docker/edit/master/manuscript/galaxy.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="setting-up-loadbalancer-with-a-galaxy-role">Setting up loadbalancer with a galaxy role</h1>
<p>With this lab, you are going to setup HAProxy, a lightweight open source load balancer using a role available in Ansible Galaxy.  </p>
<p>Browse to <a href="https://galaxy.ansible.com/">Ansible Galaxy</a> to browse or search for the roles available and understand how Galaxy works. Then proceed with the steps below to setup haproxy.</p>
<p>Fetch a role from galaxy as,</p>
<pre><code>cd chap8
ansible-galaxy install geerlingguy.haproxy
</code></pre>

<p>Create a new playbook in the top level dir with name <strong>lb.yml</strong></p>
<pre><code>- hosts: lb
  become: yes
  roles:
    - { role: geerlingguy.haproxy }

</code></pre>

<p>Also add the custom vars that you would like to override and customize as per your setup.</p>
<p>e.g.</p>
<p><code>file: group_vars/prod.yml</code></p>
<pre><code>haproxy_backend_httpchk: ''
haproxy_backend_servers:
  - name: app1
    address: 192.168.61.12:80
  - name: app2
    address: 192.168.61.13:80

</code></pre>

<p>And apply the playbook</p>
<pre><code>ansible-playbook lb.yml
</code></pre>

<p>To validate, load the haproxy configurations now for load balancer which is now running on port 80 on your host.</p>
<p>http://IPADDRESS/app</p>
<p>You could also verify by checking the haproxy configs as</p>
<pre><code>ssh devops@lb

cat /etc/haproxy/haproxy.cfg
</code></pre>

<p>You should see the following block configured in haproxy.cfg</p>
<pre><code>backend habackend
    mode http
    balance roundrobin
    option forwardfor
    cookie SERVERID insert indirect
    server app1 192.168.61.12:80 cookie app1 check
    server app2 192.168.61.13:80 cookie app2 check
</code></pre>

<p>Which confirms that haproxy has picked up the web servers and load balancing traffic across it.</p>
<h2 id="exercises">Exercises</h2>
<h3 id="nano-project-setup-mysql-database">Nano Project: Setup MySQL Database</h3>
<p>Now that you have configured load balancer along with the app servers, its time to setup database backend. And you could leverage ansible galaxy instead of writing all the code from scratch.  </p>
<p>Once you select and install role, create a playbook that would apply to <strong>db</strong> group from inventory.</p>
<p>In addition to setting up the mysql server, you would create
  * database: devopsdemo
  * user: devops
  * password: password-of-your-choice
  * root password: password-of-your-choice
and set grant permissions so that the <strong>devops</strong> user owns <strong>devopsdemo</strong> db.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../control_structures/" class="btn btn-neutral float-right" title="Controlling execution flow with conditionals, iterators and tags">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../templates_and_variables/" class="btn btn-neutral" title="Making roles reusable with vars and templates"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright @ 2017-2020 Gourav Shah, School of Devops. Some rights reserved. License CC BY-NC-SA</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/schoolofdevops/zero-to-docker/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../templates_and_variables/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../control_structures/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
